---
 layout:     post
 title:      Unreal源码百问
 subtitle:   Unreal
 date:       2024-10-23
 author:     Bob
 header-img: img/pos_bg_unreal.jpg
 catalog: true
 tags:
     - Unreal
---


### 1.如何识别引擎和插件DLL编译不匹配？
检查调用堆栈
```c
int32 GuardedMain( const TCHAR* CmdLine )
EnginePreInit( CmdLine );
int32 FEngineLoop::PreInit(const TCHAR* CmdLine)
int32 FEngineLoop::PreInitPreStartupScreen(const TCHAR* CmdLine)
bool FEngineLoop::AppInit( )
ProjectManager.CheckModuleCompatibility(IncompatibleFiles);
PluginManager.CheckModuleCompatibility(IncompatibleFiles, IncompatibleEngineFiles);
FModuleDescriptor::CheckModuleCompatibility(CurrentProject->Modules, OutIncompatibleModules);
ModuleManager.IsModuleUpToDate(Module.Name)
FModuleManifest::TryRead(FileName, Manifest)
```
通过***.modules文件记录编译信息，通过FSimpleParse解析这个文件，格式如下
```c
{
	"BuildId": "488e2f37-bf07-4f46-8a3e-5e5a4141fbac",
	"Modules": 
	{
		"ShootLikeMe": "UnrealEditor-ShootLikeMe.dll",
		"ShootLikeMeEditor": "UnrealEditor-ShootLikeMeEditor.dll"
	}
}
```
FModuleManifest::TryRead中比较BuildId是否匹配，最后ModuleManager.IsModuleUpToDate中检查Modules中的Dll是否存在



### 2.启动项目何时编译c++代码？
如果ide（eg：vs/rider）启动游戏，在启动引擎前就会编译好所有dll文件。
如果不是ide启动，实际调用UBT去处理编译，当然前置会做一些检查工作。
如果Intermediate目录还在，Binaries删了，应该是只有链接过程，很快就能在Binaries下生成dll。
如果编译的dll版本不匹配会提示：The following modules are missing or built with a different engine version

ProjectManager.CheckModuleCompatibility和PluginManager.CheckModuleCompatibility检查dll版本不匹配或者不存在就会启动编译
编译主要逻辑在DesktopPlatformWindows.cpp，实际是调用的RunUnrealBuildTool来编译
int32 FEngineLoop::PreInitPreStartupScreen(const TCHAR* CmdLine)
bool bCompileResult = FDesktopPlatformModule::Get()->CompileGameProject(FPaths::RootDir(), FPaths::GetProjectFilePath(), Context, &CompilationResult);




### 启动项目何时编译蓝图？


### 启动项目何时检查资源？
